#!/usr/bin/env node
import {Command as a} from'commander';import b from'picocolors';import * as p from'@clack/prompts';const{keys:d}=Object;import {getSettings as e,insertSettings as f} from'./functions/user_settings.js';import {getBothData as g} from'./functions/obtain_data.js';import {bytesToMB as h,colorizeSize as A,parseRepositoryUrl as j,formatDate as k,iterateTable as l,fakeSpinner as m} from'./functions/programm.js';import {createTable as n} from'./functions/create_cli_table3.js';import {askQuestion as o} from'./functions/config_questions.js';import {questions as _} from'./data/user_questions.js';var q=new a();q.configureHelp({showGlobalOptions:!0}).option('-g, --global');var r=!0;q.command('get-config').description('Get the Packagephobia CLI configuration').action(async ()=>{return console.log(JSON.stringify(await e(),null,2))});q.command('set-config').description('Configure the Packagephobia CLI').action(async ()=>{var B=await e();async function c(){p.intro(`${b.bgMagenta(b.black('  --Configure the Packagephobia CLI--  '))}`);var C={};for(const _a of Object.values(_)){var _b=await o(_a.question,_a.optionsLabel,_a.optionsValue,B[_a.settingLabel]);C[_a.settingLabel]=_b}await f(C);await m(b.bold(b.dim('Saving configuration...')),1500);p.outro(`${b.yellowBright(b.bold('Establish right!!'))}`)}c().catch(console.error)});q.arguments('<command> [version]').description('PackagePhobia CLI is a command-line tool that lets you effortlessly check the install size, dependencies, and other crucial details of your favorite packages').option('-a','Description').option('-v','--latestVersion').option('--all','Description').option('--table','Show output in table format').action(async (D,_B,_c)=>{var _d=await e();const{ppApi:E,registryApi:F}=await g(r,'all',D);var G=h(E.install.bytes),H=A(G,E.install.color),I=n({styleBorderColor:'yellow',borderChar:'1x1_double'});if(_c.a){const _A=n({styleBorderColor:'cyan',borderChar:'1x1_double'}),J=b.cyanBright(`Package: ${b.bold(E.name)}@${b.bold(E.version)}`),K=b.greenBright('\nAuthor: '+b.bold(F?.author?.name?F.author.name:'Unknown')),L=b.whiteBright(`Description: ${b.dim(F.description)}`),M=b.blueBright(`Repository: ${b.underline(j(F.repository.url))}`),N=b.yellowBright(`Install size: ${b.bold(G+' MB')}`),O=b.magentaBright(`Number of files: ${b.bold(E.install.files)}`);var P=`${J}\n${K}\n${L}\n\n${M}\n\n${N}\n${O}`;_A.push([P]);return console.log(`${_A}`)}if(_c.v){var Q=d(F.versions),R=_c.all?Q.length:_d.numTableRows;if(_c.table){var s=Q.slice(0,R),t=Q.slice(-R);let aH=[];aH=await l(s,F,aH,1,Q.length,R,_d);!_c.all&&(aH.push(['...','...','...','...']),aH=await l(t,F,aH,2,Q.length,R,_d));const aI=n({head:[b.magentaBright(b.bold('Id')),b.greenBright(b.bold('Version')),b.yellowBright(b.bold('Publish Unpacked Size')),b.blueBright(b.bold('Timestamp'))],colWidths:[6,15,30,25],colAligns:['center','center','center','center'],styleBorderColor:'blue',styleCompact:!0,borderChar:'all_double'});aI.push(...aH);return console.log(`${aI}`)}if(_c.all){var u=15,v=[];for(let i=0;i<Q.length;i+=u)v.push(Q.slice(i,i+u).map(aK=>b.dim(aK)).join(', '));const aJ=n({styleBorderColor:'white',borderChar:'1x1_double'});for(const aL of v)aJ.push([aL]);return console.log(`${aJ}`)}var w=Q.at(-1);var x=await k(_d,F.time[w]);return console.log(b.greenBright('Latest: '+b.bold(w))+' | '+b.yellowBright('Size: '+b.bold(`${h(F.versions[w].dist.unpackedSize)} MB`))+' | '+b.blueBright('Date: '+b.bold(x)))}if(_B){const{ppApi:aM,registryApi:aN}=await g(r,'specific',D,_B);if(aM.version===aN.version){const aO=n({borderChar:'all_double',styleCompact:!1,styleBorderColor:'green'}),y=b.cyanBright('Package: '+b.bold(aN.name)),aP=b.greenBright('\nAuthor: '+b.bold(aN?.author?.name?aN.author.name:'Unknown')),_C=b.whiteBright('\nDescription: '+b.dim(aN.description)),z=b.yellowBright('\nUnpacked size: '+b.bold(h(aN.dist.unpackedSize)+' MB')),_D=b.blueBright('\nRepository: '+b.bold(b.underline(j(aN.repository.url)))),aA=b.red('\nNPM version: '+b.bold(aN._npmVersion)),aB=b.green('\nNode version: '+b.bold(aN._nodeVersion)),aC=aN.dependencies,aD=aN.devDependencies,aE=y+aP+_C+z+_D+aA+aB,aF=b.dim(b.bold(b.underline('Dependencies')+':\n'))+Object.entries(aC).map(([aQ,aR])=>` · ${b.italic(aQ)}: ${b.bold(b.whiteBright(aR))}`).join('\n'),aG=b.dim(b.bold(b.underline('Dev Dependencies')+':\n'))+Object.entries(aD).map(([aS,aT])=>` · ${b.italic(aS)}: ${b.bold(b.whiteBright(aT))}`).join('\n');aO.push([aE],[aF],[aG]);return console.log(`${aO}`)}return console.log('Version not found')}I.push([H]);return console.log(`${I}`)});q.parse(process.argv);